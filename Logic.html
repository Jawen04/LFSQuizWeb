<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LFSQuiz - Home</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="assets/LFSLogo.png" type="image/x-icon">
</head>
<body>
    <div class="menu-btn" onclick="toggleMenu()">â˜°</div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <a href="index.html">Home</a>
        <a href="dataTransceiver.html">Data Transceiver</a>
        <a href="UARTTimer.html">UART Timer</a>
        <a href="ALU.html">ALU</a>
        <a href="Logic.html">Logic Expression</a>
    </div>

    <div class="content">
        <h1>Logic Expression Evaluator</h1>

        <p>
            <label for="expression">Enter logic expression:</label><br>
            <input type="text" id="expression" placeholder="e.g., (0x4D23 << 1) & 0x43A1 or A + B" size="40" />
        </p>

        <p>
            <label for="outputFormat">Select output format:</label><br>
            <select id="outputFormat">
                <option value="decimal">Decimal</option>
                <option value="hex">Hexadecimal</option>
                <option value="binary">Binary</option>
            </select>
        </p>

        <button onclick="evaluateExpression()">Calculate</button>

        <p class="answer-text" id="result1"></p>
    </div>

    <script>
        const variables = {}; // You can define variables like {A: 5, B: 3} if needed

        const inputBox = document.getElementById("expression");
        // Trigger calculation when Enter is pressed
        inputBox.addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                evaluateExpression();
                e.preventDefault(); // prevent default form submission behavior
            }
        });

        function evaluateExpression() {
            const expr = String(document.getElementById("expression").value);

            const tokens = [];
            const re = /\s*(0x[0-9a-fA-F]+|0b[01]+|0o[0-7]+|\d+|[A-Za-z_]\w*|>>>|<<|>>|xor|[+\-*/%&|^~()])/gy;
            let m;
            while ((m = re.exec(expr)) !== null) tokens.push(m[1]);

            let i = 0;
            const peek = () => tokens[i];
            const next = () => tokens[i++];

            const toNumber = (tok) => {
                if (tok.startsWith("0x")) return parseInt(tok, 16);
                if (tok.startsWith("0b")) return parseInt(tok.slice(2), 2);
                if (tok.startsWith("0o")) return parseInt(tok.slice(2), 8);
                return parseInt(tok, 10);
            };

            function parseExpression() { return parseBitwiseOr(); }

            function parseBitwiseOr() {
                let left = parseBitwiseXor();
                while (peek() === "|") {
                    next();
                    left = (left | parseBitwiseXor()) >>> 0;
                }
                return left;
            }

            function parseBitwiseXor() {
                let left = parseBitwiseAnd();
                while (peek() === "^" || peek()?.toLowerCase() === "xor") {
                    next();
                    left = (left ^ parseBitwiseAnd()) >>> 0;
                }
                return left;
            }

            function parseBitwiseAnd() {
                let left = parseShift();
                while (peek() === "&") {
                    next();
                    left = (left & parseShift()) >>> 0;
                }
                return left;
            }

            function parseShift() {
                let left = parseAddSub();
                while (["<<", ">>", ">>>"].includes(peek())) {
                    const op = next();
                    const r = parseAddSub();
                    if (op === "<<") left = (left << r) >>> 0;
                    else if (op === ">>") left = (left >> r) >>> 0;
                    else left = (left >>> r) >>> 0;
                }
                return left;
            }

            function parseAddSub() {
                let left = parseMulDiv();
                while (["+", "-"].includes(peek())) {
                    const op = next();
                    const r = parseMulDiv();
                    left = op === "+" ? left + r : left - r;
                }
                return left >>> 0;
            }

            function parseMulDiv() {
                let left = parseUnary();
                while (["*", "/", "%"].includes(peek())) {
                    const op = next();
                    const r = parseUnary();
                    if (op === "*") left *= r;
                    else if (op === "/") left = Math.floor(left / r);
                    else left %= r;
                }
                return left >>> 0;
            }

            function parseUnary() {
                if (peek() === "~") { next(); return (~parseUnary()) >>> 0; }
                if (peek() === "-") { next(); return -parseUnary(); }
                if (peek() === "+") { next(); return +parseUnary(); }
                return parsePrimary();
            }

            function parsePrimary() {
                const tok = peek();
                if (tok === "(") {
                    next();
                    const v = parseExpression();
                    if (next() !== ")") throw Error("Missing )");
                    return v;
                }
                next();
                if (/^\d/.test(tok) || tok.startsWith("0x") || tok.startsWith("0b") || tok.startsWith("0o")) return toNumber(tok);
                if (variables.hasOwnProperty(tok)) return variables[tok];
                throw new Error("Unknown token: " + tok);
            }

            try {
                const result = parseExpression();
                const format = document.getElementById("outputFormat").value;
                let formattedResult;
                if (format === "hex") formattedResult = "0x" + result.toString(16).toUpperCase();
                else if (format === "binary") formattedResult = "0b" + result.toString(2);
                else formattedResult = result.toString(10);

                document.getElementById("result1").textContent = `Result: ${formattedResult}`;
            } catch (e) {
                document.getElementById("result1").textContent = "Error: " + e.message;
            }
        }

        function toggleMenu() {
            document.getElementById("sidebar").classList.toggle("active");
        }
    </script>

</body>
</html>
